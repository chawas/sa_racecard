<!DOCTYPE html>
<html>
<head>
    <title>Manual Results Entry - {{ race.race_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .horse-row { transition: background-color 0.2s; }
        .horse-row:hover { background-color: #f8f9fa; }
        .position-input { width: 80px; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1>üìù Manual Results Entry</h1>
        <h4>{{ race.race_name }} - {{ race.race_date }} - R{{ race.race_no }}</h4>
        
        <form method="post">
            {% csrf_token %}
            {{ form.as_p }}
            
            <div class="card mt-4">
                <div class="card-header">
                    <h5>Enter Finishing Positions</h5>
                    <small class="text-muted">Enter positions 1-4 for top finishers</small>
                </div>
                <div class="card-body">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Horse No</th>
                                <th>Horse Name</th>
                                <th>Position</th>
                                <th>Margin</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for horse_form in horse_forms %}
                            <tr class="horse-row">
                                <td>{{ horse_form.horse.horse_no }}</td>
                                <td>{{ horse_form.horse.horse_name }}</td>
                                <td>
                                    <input type="number" name="horse_{{ horse_form.horse.id }}_position" 
                                           value="{{ horse_form.form.position.value|default:'' }}"
                                           class="form-control position-input" min="1" max="20"
                                           placeholder="Pos">
                                </td>
                                <td>
                                    <input type="text" name="horse_{{ horse_form.horse.id }}_margin" 
                                           value="{{ horse_form.form.margin.value|default:'' }}"
                                           class="form-control" placeholder="e.g., 1.5L">
                                </td>
                                <td>
                                    <input type="text" name="horse_{{ horse_form.horse.id }}_time" 
                                           value="{{ horse_form.form.time.value|default:'' }}"
                                           class="form-control" placeholder="e.g., 1:23.45">
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="mt-3">
                <button type="submit" class="btn btn-success">Save Results</button>
                <button type="submit" name="verify" value="true" class="btn btn-primary">
                    Save & Verify
                </button>
                <a href="{% url 'race_detail' race.id %}" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>

    <script>
        // Auto-focus first position input
        document.querySelector('.position-input')?.focus();
        
        // Quick position entry - press Enter to move to next field
        document.querySelectorAll('.position-input').forEach((input, index, inputs) => {
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const nextInput = inputs[index + 1] || document.querySelector('input[name$="_margin"]');
                    nextInput?.focus();
                }
            });
        });
    </script>
</body>
</html>